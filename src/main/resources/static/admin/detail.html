<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="detail-title">Details</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
	<link rel="icon" type="image/png" href="/images/favicon.png">

    <link rel="stylesheet" href="detail-style.css"> 
</head>
<body>
    <div class="page-container">

        <header class="top-bar">
            <a href="map.html" class="back-link" onclick="history.back(); return false;">
                 <i class="fas fa-arrow-left header-icon"></i>
            </a>
             Detail
        </header>

        <main class="detail-wrapper">
            
            <section class="media-column">
                <div class="image-gallery">
                    <div class="main-image">
                        <img id="location-image" src="" alt="Location Image" class="location-image-display">
                                             <i class="fa-solid fa-image placeholder-icon" id="placeholder-icon"></i>
                    </div>
                </div>
            </section>

            <section class="info-column">
     
                <div class="title-block">
                    <h1 class="item-name" id="location-name">...</h1>
                    <span class="location-pin-icon"><i class="fa-solid fa-location-dot"></i></span>
                    <!--<span class="bookmark-icon"><i class="fa-regular fa-bookmark"></i></span>-->
                </div>

                <hr class="info-separator">

                <!--<div class="density-status">
                    <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong></p>
                    <div class="density-level-box" id="density-status-box">...</div>
                </div>-->

                <div class="description-block">
                    <h2>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</h2>
                    <div class="schedule-detail">
                        <p class="schedule-item">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå - ‡∏®‡∏∏‡∏Å‡∏£‡πå : <span class="time-slot" id="working-hours-weekday">...</span></p>
                        <p class="schedule-item">‡πÄ‡∏™‡∏≤‡∏£‡πå - ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå : <span class="time-slot closed" id="working-hours-weekend">...</span></p>
                    </div>
  
                    <h2 class="full-description-title">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h2>
                    <p class="full-description-text" id="full-description-text">...</p>
                </div>
     
                <button class="cta-button">‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡∏ó‡∏≤‡∏á</button>

            </section>
        </main>
    </div>

    <script src="map-script.js"></script>
	<script type="module">
				  import { protectPage } from "/authGuard.js";
				  protectPage(true); // üß© ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ admin
		</script>
<script>
    // ‡πÉ‡∏ä‡πâ API Endpoint ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô fetchAndDisplayDetails
    const API_BASE_URL = 'http://localhost:8080/api/locations';

    async function fetchAndDisplayDetails() {
        // ‡∏î‡∏∂‡∏á shortName ‡∏à‡∏≤‡∏Å URL (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô searchTerm)
        const params = new URLSearchParams(window.location.search);
        const searchTerm = params.get('shortName');
    
        const locationNameElement = document.getElementById('location-name');

        if (!searchTerm) {
            locationNameElement.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà';
            return;
        }
    
        locationNameElement.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${searchTerm}...`;

        try {
            // 1. Fetch Data: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏î‡πâ‡∏ß‡∏¢ searchTerm
            const response = await fetch(`${API_BASE_URL}?search=${searchTerm}`); 

            if (!response.ok) {
                locationNameElement.textContent = `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà '${searchTerm}' ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö`;
                console.error(`Fetch failed with status: ${response.status}`);
                return;
            }
        
            // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô List (Array) ‡∏Ç‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
            const locationList = await response.json(); 
        
            if (locationList.length === 0) {
                locationNameElement.textContent = `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${searchTerm}`;
                return;
            }

            // 2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏ï‡∏≤‡∏° Logic ‡∏Ç‡∏≠‡∏á map.html)
            const locationDetails = locationList[0]; 
        
            // 3. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á workingHours ‡∏à‡∏≤‡∏Å openTime ‡πÅ‡∏•‡∏∞ closeTime
            const workingHours = (locationDetails.openTime && locationDetails.closeTime)
                ? `${locationDetails.openTime} - ${locationDetails.closeTime}`
                : 'N/A';
            
            // shortName: ‡πÉ‡∏ä‡πâ name ‡πÄ‡∏õ‡πá‡∏ô shortName ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (‡∏ï‡∏≤‡∏° Logic ‡∏Ç‡∏≠‡∏á map.html)
            const shortNameDisplay = locationDetails.name; 
        
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î field ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô field ‡∏ä‡∏∑‡πà‡∏≠ description)
            const descriptionText = locationDetails.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°';


            // 4. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Element ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Title Bar
            document.getElementById('detail-title').textContent = `${locationDetails.name} Details`;
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
            locationNameElement.textContent = `${locationDetails.name} (${searchTerm})`; 

            // ‚úÖ Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡∏°‡πà)
            const locationImage = document.getElementById('location-image');
            const placeholderIcon = document.getElementById('placeholder-icon');

            const imageFilename = locationDetails.imagePath || locationDetails.imageUrl;

            if (imageFilename) {
                // ‡∏ñ‡πâ‡∏≤ backend ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå ‡πÄ‡∏ä‡πà‡∏ô "temple.webp"
                const imageUrl = imageFilename.startsWith('http')
                    ? imageFilename // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô URL ‡πÄ‡∏ï‡πá‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
                    : `http://localhost:8080/images/${imageFilename}`; // ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å backend ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤

                locationImage.src = imageUrl;
                locationImage.style.display = 'block';
                placeholderIcon.style.display = 'none';
            } else {
                locationImage.style.display = 'none';
                placeholderIcon.style.display = 'block';
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£
            document.getElementById('working-hours-weekday').textContent = workingHours;
            document.getElementById('working-hours-weekend').textContent = workingHours;
        
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
            document.getElementById('full-description-text').textContent = descriptionText;
        
        } catch (error) {
            console.error('Error fetching location data for details page:', error);
            locationNameElement.textContent = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}`;
        }
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    document.addEventListener('DOMContentLoaded', fetchAndDisplayDetails);
</script>


    
</body>
</html>