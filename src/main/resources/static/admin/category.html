<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        body{font-family:'Sarabun',sans-serif;margin:0;background-color:#424242;display:flex;flex-direction:column;align-items:center;min-height:100vh;color:#333}
        .dashboard-container{width:100%;max-width:1200px;margin:20px;padding-bottom:80px}
        header{background-color:#b71c1c;color:#fff;padding:15px 20px;text-align:center;font-size:1.2em;font-weight:700;border-top-left-radius:8px;border-top-right-radius:8px}
        main{background-color:#f5f5f5;padding:20px;border-bottom-left-radius:8px;border-bottom-right-radius:8px}
        .actions-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
        .search-box input{padding:10px;border:1px solid #ccc;border-radius:5px;width:250px}
        .add-button{background-color:#4caf50;color:#fff;padding:10px 15px;border:none;border-radius:5px;cursor:pointer;font-size:1em;text-decoration:none}
        .add-button i{margin-right:5px}
        .data-table{width:100%;border-collapse:collapse;background-color:#fff;box-shadow:0 2px 4px rgba(0,0,0,.1)}
        .data-table td,.data-table th{padding:12px 15px;text-align:left;border-bottom:1px solid #ddd}
        .data-table th{background-color:#e0e0e0;font-weight:700}
        .data-table .actions-cell{position:relative;text-align:center}
        .menu-icon{cursor:pointer;padding:5px;border-radius:50%}
        .menu-icon:hover{background-color:#f0f0f0}
        .dropdown-menu{display:none;position:absolute;right:25px;top:10px;background-color:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.1);z-index:100;width:120px;overflow:hidden}
        .dropdown-menu.show{display:block}
        .dropdown-menu a{display:flex;align-items:center;gap:10px;padding:10px 15px;color:#333;text-decoration:none;font-size:.9em}
        .dropdown-menu a:hover{background-color:#f5f5f5}
        .dropdown-menu a .fa-trash-alt{color:#b71c1c}
        .row-pending-deletion{background-color:#ffebee!important;transition:background-color .3s}
        .confirm-btn{color:#fff!important;background-color:#d32f2f!important;font-weight:700}
        footer{background-color:#fff;position:fixed;bottom:0;left:0;width:100%;display:flex;justify-content:space-around;align-items:center;padding:10px 0;box-shadow:0 -2px 5px rgba(0,0,0,.1)}
        .nav-item{display:flex;flex-direction:column;align-items:center;color:#666;text-decoration:none;font-size:.8em}
        .nav-item i{font-size:1.5em;margin-bottom:5px}
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header>Category Management</header>
        <main>
            <div class="actions-bar">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà">
                </div>
                <a href="add-category.html" class="add-button"><i class="fas fa-plus"></i> Add New Category</a>
            </div>
            <table class="data-table">
				<thead>
				  <tr>
				    <th style="width: 10%;">ID</th>
				    <th>Category</th>
				    <th style="width: 15%; text-align:center;">Action</th>
				  </tr>
				</thead>
                <tbody id="category-table-body"></tbody>
            </table>
        </main>
    </div>
    <footer>
        <a href="/map.html" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a>
        <a href="/admin/dashboard.html" class="nav-item active"><i class="fas fa-cog"></i><span>Admin Dashboard</span></a>
        <a href="#" class="nav-item"><i class="fas fa-user"></i><span>Profile</span></a>
    </footer>

	<script>
	document.addEventListener('DOMContentLoaded', async function () {
	  const API_URL = 'http://localhost:8080/api/categories';
	  const tableBody = document.getElementById('category-table-body');
	  const searchInput = document.getElementById('searchInput');
	  let categories = [];

	  // üîπ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å backend
	  async function loadCategories() {
	    try {
	      const res = await fetch(API_URL);
	      if (!res.ok) throw new Error('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
	      const dto = await res.json();
	      categories = Array.isArray(dto) ? dto : dto.categories || [];
	      renderTable(categories);
	    } catch (err) {
	      console.error('‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', err);
	      tableBody.innerHTML = `<tr><td colspan="3" style="text-align:center;">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</td></tr>`;
	    }
	  }

	  // üîπ ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
	  function renderTable(data) {
	    tableBody.innerHTML = '';
	    if (data.length === 0) {
	      tableBody.innerHTML = `<tr><td colspan="3" style="text-align:center;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</td></tr>`;
	      return;
	    }
	    data.forEach(cat => {
	      const row = document.createElement('tr');
	      row.innerHTML = `
	        <td>${cat.id}</td>
	        <td>${cat.category || '-'}</td>
	        <td style="text-align:center;">
	          <button class="delete-btn" data-id="${cat.id}" 
	                  style="background-color:#d32f2f;color:#fff;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;">
	            <i class="fas fa-trash-alt"></i> ‡∏•‡∏ö
	          </button>
	        </td>
	      `;
	      tableBody.appendChild(row);
	    });
	  }

	  // üîπ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
	  searchInput.addEventListener('keyup', function () {
	    const term = searchInput.value.toLowerCase();
	    const filtered = categories.filter(c => c.category && c.category.toLowerCase().includes(term));
	    renderTable(filtered);
	  });

	  // üîπ ‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏à‡∏≤‡∏Å backend
	  tableBody.addEventListener('click', async function (e) {
	    const btn = e.target.closest('.delete-btn');
	    if (!btn) return;

	    const id = btn.getAttribute('data-id');
	    const cat = categories.find(c => c.id == id);
	    if (!cat) return;

	    if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà "${cat.category}" ?`)) return;

	    try {
	      const res = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
	      if (!res.ok) throw new Error(await res.text());
	      alert(`‚úÖ ‡∏•‡∏ö "${cat.category}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
	      await loadCategories(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
	    } catch (err) {
	      alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
	      console.error(err);
	    }
	  });

	  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
	  await loadCategories();
	});
	</script>


</body>
</html>